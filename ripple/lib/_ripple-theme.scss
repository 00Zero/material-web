//
// Copyright 2022 Google LLC
// SPDX-License-Identifier: Apache-2.0
//

// stylelint-disable selector-class-pattern --
// Selector '.md3-*' should only be used in this project.

@use 'sass:map';
@use '../../sass/theme';
@use '../../tokens';

@function values($exclude-hardcoded-values: false) {
  $state-values: tokens.md-sys-state-values($exclude-hardcoded-values);
  $default-shape: map.get(
    tokens.md-sys-shape-values($exclude-hardcoded-values),
    corner-none
  );
  $default-color: if($exclude-hardcoded-values, null, black);
  // add missing tokens
  $values: map.merge(
    $state-values,
    (
      state-layer-shape: $default-shape,
      focus-state-layer-color: $default-color,
      hover-state-layer-color: $default-color,
      pressed-state-layer-color: $default-color,
      dragged-state-layer-color: $default-color,
    )
  );

  @return $values;
}

@mixin theme($theme) {
  $theme: theme.validate-theme(values(), $theme);
  $theme: theme.create-theme-vars($theme, ripple);

  @include theme.emit-theme-vars($theme);
}

@mixin theme-styles($theme) {
  $theme: theme.validate-theme-styles(values(), $theme, $require-all: false);

  $theme: theme.create-theme-vars($theme, ripple);

  & {
    border-radius: map.get($theme, state-layer-shape);
  }

  &::before {
    background-color: map.get($theme, hover-state-layer-color);
  }

  &::after {
    background: radial-gradient(
      closest-side,
      #{map.get($theme, pressed-state-layer-color)} max(calc(100% - 70px), 65%),
      transparent 100%
    );
  }

  &.md3-ripple--hovered::before {
    background-color: map.get($theme, hover-state-layer-color);
    opacity: map.get($theme, hover-state-layer-opacity);
  }

  &.md3-ripple--focused::before {
    background-color: map.get($theme, focus-state-layer-color);
    opacity: map.get($theme, focus-state-layer-opacity);
  }

  &.md3-ripple--pressed::after {
    opacity: map.get($theme, pressed-state-layer-opacity);
  }

  &.md3-ripple--unbounded {
    $unbounded: (
      state-layer-shape: map.get(tokens.md-sys-shape-values(), corner-full),
    );
    $unbounded: theme.create-theme-vars($unbounded, ripple);
    border-radius: map.get($unbounded, state-layer-shape);
  }

  // TODO(b/230630968): create a forced-colors-mode mixin
  @media screen and (forced-colors: active) {
    display: none;
  }
}
